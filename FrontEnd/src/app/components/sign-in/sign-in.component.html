<div class="login-container">
  <div class="login-card">
    <img src="assets/images/logo.png" alt="Logo Startup Village" class="login-logo" />
    <h2 class="login-title">Bienvenue</h2>

    <!-- Show login error -->
    <div class="error-message" *ngIf="loginError">
      {{ loginError }}
    </div>

    <!-- === STEP 1: LOGIN FORM === -->
    <form *ngIf="mfaStep === 'NONE'" (ngSubmit)="onLogin()" [formGroup]="loginForm">
      <div class="form-group">
        <label for="email">Adresse e-mail</label>
        <input formControlName="email" type="email" id="email" placeholder="Votre adresse e-mail" />
      </div>

      <div class="form-group">
        <label for="password">Mot de passe</label>
        <input formControlName="password" type="password" id="password" placeholder="Votre mot de passe" />
      </div>

      <div class="form-options">
        <label class="remember-me">
          <input type="checkbox" formControlName="rememberMe" />
          Rester connecté
        </label>
        <a class="forgot-password" href="/forgot-password">Mot de passe oublié ?</a>
      </div>

      <button class="btn-primary" type="submit">Se connecter</button>
    </form>

    <!-- === STEP 2: CHOOSE MFA TYPE === -->
    <div *ngIf="mfaStep === 'CHOOSE'" class="mfa-choice">
      <p>MFA est activé pour {{ emailForMfa }}. Veuillez choisir une méthode :</p>
      <div class="form-group">
        <button class="btn-secondary" (click)="onChooseMfaType('EMAIL')">Recevoir un code par Email</button>
        <button class="btn-secondary" (click)="onChooseMfaType('APP')">Utiliser une application d'authentification</button>
      </div>
    </div>

<!-- === STEP 3A: SHOW QR CODE for APP MFA === -->
<div *ngIf="mfaStep === 'APP_SETUP'" class="mfa-setup">
  <p>Scannez ce QR Code avec Google Authenticator :</p>
  <div class="qr-wrapper">
    <img [src]="qrCodeUri" alt="QR Code MFA" class="qr-code" />
  </div>

  <p>Ensuite, entrez le code généré :</p>
  <form (ngSubmit)="onVerifyMfa()">
    <div class="form-group">
      <label for="mfaCode">Code MFA</label>
      <input id="mfaCode" [(ngModel)]="mfaCode" name="mfaCode" type="text" placeholder="Entrez le code à 6 chiffres" required />
    </div>
    <button class="btn-primary" type="submit">Valider</button>
  </form>
</div>




    <!-- === STEP 3: VERIFY MFA CODE === -->
    <form *ngIf="mfaStep === 'VERIFY'" (ngSubmit)="onVerifyMfa()">
      <p>Entrez le code MFA reçu via <strong>{{ selectedMfaType }}</strong> :</p>
      <div class="form-group">
        <label for="mfaCode">Code MFA</label>
        <input id="mfaCode" [(ngModel)]="mfaCode" name="mfaCode" type="text" placeholder="Entrez votre code MFA" required />
      </div>
      <button class="btn-primary" type="submit">Valider</button>
    </form>

    <!-- Signup link shown only on initial login screen -->
    <p class="signup-text" *ngIf="mfaStep === 'NONE'">
      Vous n'avez pas de compte ?
      <a class="signup-link" href="/signup">Créer un compte</a>
    </p>
  </div>
</div>
